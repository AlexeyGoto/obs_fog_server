{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="card">
    <h2 style="margin:0 0 8px 0">Сводка</h2>
    <div class="hint">Аккаунты/ПК/активные слоты.</div>
    <div style="margin-top:10px">
      <div>Аккаунты: <b>{{ stats.accounts_total }}</b> (включено: <b>{{ stats.accounts_enabled }}</b>)</div>
      <div>ПК: <b>{{ stats.pcs_total }}</b> (включено: <b>{{ stats.pcs_enabled }}</b>)</div>
      <div>Активные слоты: <b>{{ stats.active_leases }}</b></div>
    </div>
  </div>
  <div class="card">
    <h2 style="margin:0 0 8px 0">Как работает на ПК</h2>
    <ol class="hint" style="line-height:1.6; margin: 0; padding-left: 18px;">
      <li>ПК зовёт <code>/api/v1/lease/acquire</code> (имя ПК + ключ).</li>
      <li>Если слот есть — получает <code>token</code>.</li>
      <li>По токену скачивает <code>/api/v1/loginusers</code> и кладёт в Steam.</li>
      <li>Шлёт <code>heartbeat</code>, пока идёт обновление.</li>
      <li>По окончании — <code>release</code>.</li>
    </ol>
  </div>
</div>

<div class="card">
  <h2 style="margin:0 0 10px 0">Последние слоты (30)</h2>
  <table>
    <thead>
      <tr>
        <th>ПК</th><th>Аккаунт</th><th>Создан</th><th>Истекает</th><th>Состояние</th>
      </tr>
    </thead>
    <tbody>
    {% for l in leases %}
      <tr>
        <td><b>{{ l.pc_name }}</b></td>
        <td>{{ l.account_name }}</td>
        <td class="muted">{{ l.created_at }}</td>
        <td class="muted">{{ l.expires_at }}</td>
        <td>
          {% if l.released_at %}
            <span class="pill bad">released</span>
          {% else %}
            <span class="pill ok">active</span>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    {% if leases|length == 0 %}
      <tr><td colspan="5" class="muted">Пока пусто.</td></tr>
    {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
