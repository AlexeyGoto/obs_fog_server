<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Live Streams</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#111; --fg:#eee; --card:#1b1b1b; --muted:#8a8a8a; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--fg); }
    header { padding:12px 16px; background:#000; border-bottom:1px solid #222; }
    h1 { font-size:18px; margin:0; }
    .grid { display:grid; gap:12px; padding:12px; grid-template-columns: repeat(auto-fill, minmax(320px,1fr)); }
    .card { background:var(--card); border:1px solid #222; border-radius:14px; padding:10px; }
    .title { font-size:14px; margin:0 0 8px; color:#ddd; }
    video { width:100%; height:auto; background:#000; border-radius:10px; }
    .offline { color:var(--muted); padding:24px 8px; text-align:center; border:1px dashed #333; border-radius:10px; }
    footer { color:#aaa; font-size:12px; padding:8px 16px 16px; }
  </style>
</head>
<body>
  <header><h1>Активные стримы (до 10)</h1></header>
  <div class="grid" id="grid"></div>
  <footer>OBS: <code>rtmp://&lt;домен_или_IP&gt;/live/&lt;ключ&gt;</code>. Плейлист: <code>/hls/&lt;ключ&gt;/index.m3u8</code></footer>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0"></script>
  <script>
    const STREAMS = [
      { name: "Stream 1", key: "stream1" },
      { name: "Stream 2", key: "stream2" },
      { name: "Stream 3", key: "stream3" },
      { name: "Stream 4", key: "stream4" },
      { name: "Stream 5", key: "stream5" },
      { name: "Stream 6", key: "stream6" },
      { name: "Stream 7", key: "stream7" },
      { name: "Stream 8", key: "stream8" },
      { name: "Stream 9", key: "stream9" },
      { name: "Stream 10", key: "stream10" }
    ];

    const grid = document.getElementById('grid');

    STREAMS.forEach((s) => {
      const card = document.createElement('div');
      card.className = 'card';
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = `${s.name} — ключ: ${s.key}`;
      const video = document.createElement('video');
      video.setAttribute('controls', '');
      video.setAttribute('muted', '');
      video.setAttribute('autoplay', '');
      video.setAttribute('playsinline', '');
      card.appendChild(title);
      card.appendChild(video);
      grid.appendChild(card);

      const src = `/hls/${encodeURIComponent(s.key)}/index.m3u8`;

      const setOffline = () => {
        if (video.parentElement) video.parentElement.removeChild(video);
        const off = document.createElement('div');
        off.className = 'offline';
        off.textContent = `${s.name}: offline`;
        card.appendChild(off);
      };

      if (Hls.isSupported()) {
        const hls = new Hls({ liveBackBufferLength: 0 });
        hls.loadSource(src);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(()=>{}));
        hls.on(Hls.Events.ERROR, (_e, data) => {
          if (data?.type === Hls.ErrorTypes.NETWORK_ERROR) {
            hls.destroy(); setOffline();
          }
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
        video.addEventListener('error', setOffline, { once:true });
        video.play().catch(()=>{});
      } else {
        setOffline();
      }
    });
  </script>
</body>
</html>
