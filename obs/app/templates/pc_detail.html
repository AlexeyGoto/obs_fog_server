{% extends "base.html" %}
{% block content %}
<div class="flex items-start justify-between gap-4">
  <div>
    <h1 class="text-2xl font-semibold">{{ pc.name }}</h1>
    <div class="mt-2 text-sm text-slate-700">
      <div>RTMP Server: <span class="font-mono">rtmp://{{ request.url.hostname }}:1935/live</span></div>
      <div>Stream Key: <span class="font-mono">{{ pc.stream_key }}</span></div>
      <div class="mt-1">HLS: <a class="text-blue-600 font-mono" href="{{ hls_url }}">{{ hls_url }}</a></div>
    </div>
  </div>
  <a class="px-3 py-2 rounded bg-slate-900 text-white" href="/">Назад</a>
</div>

<div class="mt-6 bg-white rounded shadow p-4">
  <div class="font-semibold mb-2">Live</div>
  <video id="video" controls class="w-full rounded bg-black" style="max-height:420px;"></video>
  <script>
    const video = document.getElementById('video');
    const src = "{{ hls_url }}";
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(src);
      hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = src;
    }
  </script>
</div>

<div class="mt-6 bg-white rounded shadow p-4">
  <div class="font-semibold mb-3">Последние сессии</div>
  <div class="space-y-2">
    {% for s in sessions %}
      <div class="flex justify-between text-sm border-b pb-2">
        <div>#{{ s.id }} — {{ s.status }}</div>
        <div class="text-slate-600">{{ s.started_at }}{% if s.ended_at %} → {{ s.ended_at }}{% endif %}</div>
      </div>
    {% endfor %}
    {% if not sessions %}<div class="text-slate-600">Пока нет сессий.</div>{% endif %}
  </div>
</div>
{% endblock %}
